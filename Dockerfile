FROM ubuntu
MAINTAINER jasoncian
USER root
RUN set -x; buildDeps='gcc libc6-dev make wget' \
    && apt-get update \
    && apt-get install -y $buildDeps \
    && wget -O redis.tar.gz https://download.redis.io/releases/redis-4.0.11.tar.gz\
    && mkdir /usr/src/redis\
    && mv redis.tar.gz /usr/src/redis\
    && cd /usr/src/redis\
    && tar -xzf redis.tar.gz\
    && cd redis-4.0.11\
    && make\
    && make install \
    && rm -rf /var/lib/apt/lists/* \
    && cd ..\
    && rm redis.tar.gz \
    && cd redis-4.0.11\
    && cd src\
    && cp redis-server /usr/bin\
    && cp redis-cli /usr/bin\
    && apt-get purge -y --auto-remove $buildDeps
RUN apt-get update \
    && apt-get install -y openssh-server
ADD redis.conf /etc/redis.conf
ADD sshd_config /etc/ssh/sshd_config
EXPOSE 6379 22
RUN /etc/init.d/ssh restart
CMD ["redis-server", "/etc/redis.conf"]
